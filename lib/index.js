var sn=Object.create;var ae=Object.defineProperty,an=Object.defineProperties,cn=Object.getOwnPropertyDescriptor,un=Object.getOwnPropertyDescriptors,fn=Object.getOwnPropertyNames,yt=Object.getOwnPropertySymbols,dn=Object.getPrototypeOf,wt=Object.prototype.hasOwnProperty,ln=Object.prototype.propertyIsEnumerable;var vt=(e,t,r)=>t in e?ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,z=(e,t)=>{for(var r in t||(t={}))wt.call(t,r)&&vt(e,r,t[r]);if(yt)for(var r of yt(t))ln.call(t,r)&&vt(e,r,t[r]);return e},Ne=(e,t)=>an(e,un(t));var v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),bt=(e,t)=>{for(var r in t)ae(e,r,{get:t[r],enumerable:!0})},Ct=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of fn(t))!wt.call(e,i)&&i!==r&&ae(e,i,{get:()=>t[i],enumerable:!(n=cn(t,i))||n.enumerable});return e};var P=(e,t,r)=>(r=e!=null?sn(dn(e)):{},Ct(t||!e||!e.__esModule?ae(r,"default",{value:e,enumerable:!0}):r,e)),mn=e=>Ct(ae({},"__esModule",{value:!0}),e);var Pt=v((fo,jt)=>{var X=1e3,K=X*60,Z=K*60,W=Z*24,Cn=W*7,En=W*365.25;jt.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Fn(e);if(r==="number"&&isFinite(e))return t.long?_n(e):Sn(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Fn(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*En;case"weeks":case"week":case"w":return r*Cn;case"days":case"day":case"d":return r*W;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Z;case"minutes":case"minute":case"mins":case"min":case"m":return r*K;case"seconds":case"second":case"secs":case"sec":case"s":return r*X;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Sn(e){var t=Math.abs(e);return t>=W?Math.round(e/W)+"d":t>=Z?Math.round(e/Z)+"h":t>=K?Math.round(e/K)+"m":t>=X?Math.round(e/X)+"s":e+"ms"}function _n(e){var t=Math.abs(e);return t>=W?ge(e,t,W,"day"):t>=Z?ge(e,t,Z,"hour"):t>=K?ge(e,t,K,"minute"):t>=X?ge(e,t,X,"second"):e+" ms"}function ge(e,t,r,n){var i=t>=r*1.5;return Math.round(e/r)+" "+n+(i?"s":"")}});var He=v((lo,Tt)=>{function Rn(e){r.debug=r,r.default=r,r.coerce=u,r.disable=o,r.enable=i,r.enabled=s,r.humanize=Pt(),r.destroy=f,Object.keys(e).forEach(a=>{r[a]=e[a]}),r.names=[],r.skips=[],r.formatters={};function t(a){let d=0;for(let l=0;l<a.length;l++)d=(d<<5)-d+a.charCodeAt(l),d|=0;return r.colors[Math.abs(d)%r.colors.length]}r.selectColor=t;function r(a){let d,l=null,h,x;function p(...m){if(!p.enabled)return;let y=p,w=Number(new Date),F=w-(d||w);y.diff=F,y.prev=d,y.curr=w,d=w,m[0]=r.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let N=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(oe,k)=>{if(oe==="%%")return"%";N++;let se=r.formatters[k];if(typeof se=="function"){let on=m[N];oe=se.call(y,on),m.splice(N,1),N--}return oe}),r.formatArgs.call(y,m),(y.log||r.log).apply(y,m)}return p.namespace=a,p.useColors=r.useColors(),p.color=r.selectColor(a),p.extend=n,p.destroy=r.destroy,Object.defineProperty(p,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(h!==r.namespaces&&(h=r.namespaces,x=r.enabled(a)),x),set:m=>{l=m}}),typeof r.init=="function"&&r.init(p),p}function n(a,d){let l=r(this.namespace+(typeof d>"u"?":":d)+a);return l.log=this.log,l}function i(a){r.save(a),r.namespaces=a,r.names=[],r.skips=[];let d,l=(typeof a=="string"?a:"").split(/[\s,]+/),h=l.length;for(d=0;d<h;d++)!l[d]||(a=l[d].replace(/\*/g,".*?"),a[0]==="-"?r.skips.push(new RegExp("^"+a.slice(1)+"$")):r.names.push(new RegExp("^"+a+"$")))}function o(){let a=[...r.names.map(c),...r.skips.map(c).map(d=>"-"+d)].join(",");return r.enable(""),a}function s(a){if(a[a.length-1]==="*")return!0;let d,l;for(d=0,l=r.skips.length;d<l;d++)if(r.skips[d].test(a))return!1;for(d=0,l=r.names.length;d<l;d++)if(r.names[d].test(a))return!0;return!1}function c(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function u(a){return a instanceof Error?a.stack||a.message:a}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Tt.exports=Rn});var Mt=v((R,xe)=>{R.formatArgs=On;R.save=In;R.load=qn;R.useColors=Ln;R.storage=zn();R.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();R.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Ln(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function On(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+xe.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(r++,i==="%c"&&(n=r))}),e.splice(n,0,t)}R.log=console.debug||console.log||(()=>{});function In(e){try{e?R.storage.setItem("debug",e):R.storage.removeItem("debug")}catch{}}function qn(){let e;try{e=R.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function zn(){try{return localStorage}catch{}}xe.exports=He()(R);var{formatters:An}=xe.exports;An.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var Bt=v((mo,Nt)=>{"use strict";Nt.exports=(e,t=process.argv)=>{let r=e.startsWith("-")?"":e.length===1?"-":"--",n=t.indexOf(r+e),i=t.indexOf("--");return n!==-1&&(i===-1||n<i)}});var $t=v((po,Dt)=>{"use strict";var jn=require("os"),Ut=require("tty"),O=Bt(),{env:b}=process,B;O("no-color")||O("no-colors")||O("color=false")||O("color=never")?B=0:(O("color")||O("colors")||O("color=true")||O("color=always"))&&(B=1);"FORCE_COLOR"in b&&(b.FORCE_COLOR==="true"?B=1:b.FORCE_COLOR==="false"?B=0:B=b.FORCE_COLOR.length===0?1:Math.min(parseInt(b.FORCE_COLOR,10),3));function ke(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function We(e,t){if(B===0)return 0;if(O("color=16m")||O("color=full")||O("color=truecolor"))return 3;if(O("color=256"))return 2;if(e&&!t&&B===void 0)return 0;let r=B||0;if(b.TERM==="dumb")return r;if(process.platform==="win32"){let n=jn.release().split(".");return Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in b)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(n=>n in b)||b.CI_NAME==="codeship"?1:r;if("TEAMCITY_VERSION"in b)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(b.TEAMCITY_VERSION)?1:0;if(b.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in b){let n=parseInt((b.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(b.TERM_PROGRAM){case"iTerm.app":return n>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(b.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(b.TERM)||"COLORTERM"in b?1:r}function Pn(e){let t=We(e,e&&e.isTTY);return ke(t)}Dt.exports={supportsColor:Pn,stdout:ke(We(!0,Ut.isatty(1))),stderr:ke(We(!0,Ut.isatty(2)))}});var kt=v((E,ve)=>{var Tn=require("tty"),ye=require("util");E.init=Hn;E.log=Un;E.formatArgs=Nn;E.save=Dn;E.load=$n;E.useColors=Mn;E.destroy=ye.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");E.colors=[6,2,3,4,5,1];try{let e=$t();e&&(e.stderr||e).level>=2&&(E.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}E.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[t];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),e[r]=n,e},{});function Mn(){return"colors"in E.inspectOpts?Boolean(E.inspectOpts.colors):Tn.isatty(process.stderr.fd)}function Nn(e){let{namespace:t,useColors:r}=this;if(r){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${t} \x1B[0m`;e[0]=o+e[0].split(`
`).join(`
`+o),e.push(i+"m+"+ve.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=Bn()+t+" "+e[0]}function Bn(){return E.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Un(...e){return process.stderr.write(ye.format(...e)+`
`)}function Dn(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function $n(){return process.env.DEBUG}function Hn(e){e.inspectOpts={};let t=Object.keys(E.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=E.inspectOpts[t[r]]}ve.exports=He()(E);var{formatters:Ht}=ve.exports;Ht.o=function(e){return this.inspectOpts.colors=this.useColors,ye.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};Ht.O=function(e){return this.inspectOpts.colors=this.useColors,ye.inspect(e,this.inspectOpts)}});var Ge=v((ho,Ve)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Ve.exports=Mt():Ve.exports=kt()});var Gt=v((go,Vt)=>{Vt.exports=Wt;function Wt(e,t){if(e&&t)return Wt(e)(t);if(typeof e!="function")throw new TypeError("need wrapper function");return Object.keys(e).forEach(function(n){r[n]=e[n]}),r;function r(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var o=e.apply(this,n),s=n[n.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(c){o[c]=s[c]}),o}}});var Ye=v((xo,Je)=>{var Jt=Gt();Je.exports=Jt(we);Je.exports.strict=Jt(Yt);we.proto=we(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return we(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return Yt(this)},configurable:!0})});function we(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function Yt(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}});var Zt=v((yo,Kt)=>{var kn=Ye(),Wn=function(){},Vn=function(e){return e.setHeader&&typeof e.abort=="function"},Gn=function(e){return e.stdio&&Array.isArray(e.stdio)&&e.stdio.length===3},Xt=function(e,t,r){if(typeof t=="function")return Xt(e,null,t);t||(t={}),r=kn(r||Wn);var n=e._writableState,i=e._readableState,o=t.readable||t.readable!==!1&&e.readable,s=t.writable||t.writable!==!1&&e.writable,c=!1,u=function(){e.writable||f()},f=function(){s=!1,o||r.call(e)},a=function(){o=!1,s||r.call(e)},d=function(m){r.call(e,m?new Error("exited with error code: "+m):null)},l=function(m){r.call(e,m)},h=function(){process.nextTick(x)},x=function(){if(!c){if(o&&!(i&&i.ended&&!i.destroyed))return r.call(e,new Error("premature close"));if(s&&!(n&&n.ended&&!n.destroyed))return r.call(e,new Error("premature close"))}},p=function(){e.req.on("finish",f)};return Vn(e)?(e.on("complete",f),e.on("abort",h),e.req?p():e.on("request",p)):s&&!n&&(e.on("end",u),e.on("close",u)),Gn(e)&&e.on("exit",d),e.on("end",a),e.on("finish",f),t.error!==!1&&e.on("error",l),e.on("close",h),function(){c=!0,e.removeListener("complete",f),e.removeListener("abort",h),e.removeListener("request",p),e.req&&e.req.removeListener("finish",f),e.removeListener("end",u),e.removeListener("close",u),e.removeListener("finish",f),e.removeListener("exit",d),e.removeListener("end",a),e.removeListener("error",l),e.removeListener("close",h)}};Kt.exports=Xt});var tr=v((vo,er)=>{var Jn=Ye(),Yn=Zt(),Xe=require("fs"),ce=function(){},Xn=/^v?\.0/.test(process.version),be=function(e){return typeof e=="function"},Kn=function(e){return!Xn||!Xe?!1:(e instanceof(Xe.ReadStream||ce)||e instanceof(Xe.WriteStream||ce))&&be(e.close)},Zn=function(e){return e.setHeader&&be(e.abort)},Qn=function(e,t,r,n){n=Jn(n);var i=!1;e.on("close",function(){i=!0}),Yn(e,{readable:t,writable:r},function(s){if(s)return n(s);i=!0,n()});var o=!1;return function(s){if(!i&&!o){if(o=!0,Kn(e))return e.close(ce);if(Zn(e))return e.abort();if(be(e.destroy))return e.destroy();n(s||new Error("stream was destroyed"))}}},Qt=function(e){e()},ei=function(e,t){return e.pipe(t)},ti=function(){var e=Array.prototype.slice.call(arguments),t=be(e[e.length-1]||ce)&&e.pop()||ce;if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new Error("pump requires two streams per minimum");var r,n=e.map(function(i,o){var s=o<e.length-1,c=o>0;return Qn(i,s,c,function(u){r||(r=u),u&&n.forEach(Qt),!s&&(n.forEach(Qt),t(r))})});return e.reduce(ei)};er.exports=ti});var nr=v((wo,rr)=>{"use strict";var{PassThrough:ri}=require("stream");rr.exports=e=>{e=z({},e);let{array:t}=e,{encoding:r}=e,n=r==="buffer",i=!1;t?i=!(r||n):r=r||"utf8",n&&(r=null);let o=new ri({objectMode:i});r&&o.setEncoding(r);let s=0,c=[];return o.on("data",u=>{c.push(u),i?s=c.length:s+=u.length}),o.getBufferedValue=()=>t?c:n?Buffer.concat(c,s):c.join(""),o.getBufferedLength=()=>s,o}});var ir=v((bo,Q)=>{"use strict";var{constants:ni}=require("buffer"),ii=tr(),oi=nr(),Ce=class extends Error{constructor(){super("maxBuffer exceeded"),this.name="MaxBufferError"}};async function Ee(e,t){if(!e)return Promise.reject(new Error("Expected a stream"));t=z({maxBuffer:1/0},t);let{maxBuffer:r}=t,n;return await new Promise((i,o)=>{let s=c=>{c&&n.getBufferedLength()<=ni.MAX_LENGTH&&(c.bufferedData=n.getBufferedValue()),o(c)};n=ii(e,oi(t),c=>{if(c){s(c);return}i()}),n.on("data",()=>{n.getBufferedLength()>r&&s(new Ce)})}),n.getBufferedValue()}Q.exports=Ee;Q.exports.default=Ee;Q.exports.buffer=(e,t)=>Ee(e,Ne(z({},t),{encoding:"buffer"}));Q.exports.array=(e,t)=>Ee(e,Ne(z({},t),{array:!0}));Q.exports.MaxBufferError=Ce});var cr=v((Co,ar)=>{ar.exports=Fe;function Fe(){this.pending=0,this.max=1/0,this.listeners=[],this.waiting=[],this.error=null}Fe.prototype.go=function(e){this.pending<this.max?sr(this,e):this.waiting.push(e)};Fe.prototype.wait=function(e){this.pending===0?e(this.error):this.listeners.push(e)};Fe.prototype.hold=function(){return or(this)};function or(e){e.pending+=1;var t=!1;return r;function r(i){if(t)throw new Error("callback called twice");if(t=!0,e.error=e.error||i,e.pending-=1,e.waiting.length>0&&e.pending<e.max)sr(e,e.waiting.shift());else if(e.pending===0){var o=e.listeners;e.listeners=[],o.forEach(n)}}function n(i){i(e.error)}}function sr(e,t){t(or(e))}});var fr=v(fe=>{var ue=require("fs"),Se=require("util"),Ke=require("stream"),ur=Ke.Readable,Ze=Ke.Writable,si=Ke.PassThrough,ai=cr(),_e=require("events").EventEmitter;fe.createFromBuffer=ci;fe.createFromFd=ui;fe.BufferSlicer=M;fe.FdSlicer=T;Se.inherits(T,_e);function T(e,t){t=t||{},_e.call(this),this.fd=e,this.pend=new ai,this.pend.max=1,this.refCount=0,this.autoClose=!!t.autoClose}T.prototype.read=function(e,t,r,n,i){var o=this;o.pend.go(function(s){ue.read(o.fd,e,t,r,n,function(c,u,f){s(),i(c,u,f)})})};T.prototype.write=function(e,t,r,n,i){var o=this;o.pend.go(function(s){ue.write(o.fd,e,t,r,n,function(c,u,f){s(),i(c,u,f)})})};T.prototype.createReadStream=function(e){return new Re(this,e)};T.prototype.createWriteStream=function(e){return new Le(this,e)};T.prototype.ref=function(){this.refCount+=1};T.prototype.unref=function(){var e=this;if(e.refCount-=1,e.refCount>0)return;if(e.refCount<0)throw new Error("invalid unref");e.autoClose&&ue.close(e.fd,t);function t(r){r?e.emit("error",r):e.emit("close")}};Se.inherits(Re,ur);function Re(e,t){t=t||{},ur.call(this,t),this.context=e,this.context.ref(),this.start=t.start||0,this.endOffset=t.end,this.pos=this.start,this.destroyed=!1}Re.prototype._read=function(e){var t=this;if(!t.destroyed){var r=Math.min(t._readableState.highWaterMark,e);if(t.endOffset!=null&&(r=Math.min(r,t.endOffset-t.pos)),r<=0){t.destroyed=!0,t.push(null),t.context.unref();return}t.context.pend.go(function(n){if(t.destroyed)return n();var i=new Buffer(r);ue.read(t.context.fd,i,0,r,t.pos,function(o,s){o?t.destroy(o):s===0?(t.destroyed=!0,t.push(null),t.context.unref()):(t.pos+=s,t.push(i.slice(0,s))),n()})})}};Re.prototype.destroy=function(e){this.destroyed||(e=e||new Error("stream destroyed"),this.destroyed=!0,this.emit("error",e),this.context.unref())};Se.inherits(Le,Ze);function Le(e,t){t=t||{},Ze.call(this,t),this.context=e,this.context.ref(),this.start=t.start||0,this.endOffset=t.end==null?1/0:+t.end,this.bytesWritten=0,this.pos=this.start,this.destroyed=!1,this.on("finish",this.destroy.bind(this))}Le.prototype._write=function(e,t,r){var n=this;if(!n.destroyed){if(n.pos+e.length>n.endOffset){var i=new Error("maximum file length exceeded");i.code="ETOOBIG",n.destroy(),r(i);return}n.context.pend.go(function(o){if(n.destroyed)return o();ue.write(n.context.fd,e,0,e.length,n.pos,function(s,c){s?(n.destroy(),o(),r(s)):(n.bytesWritten+=c,n.pos+=c,n.emit("progress"),o(),r())})})}};Le.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.context.unref())};Se.inherits(M,_e);function M(e,t){_e.call(this),t=t||{},this.refCount=0,this.buffer=e,this.maxChunkSize=t.maxChunkSize||Number.MAX_SAFE_INTEGER}M.prototype.read=function(e,t,r,n,i){var o=n+r,s=o-this.buffer.length,c=s>0?s:r;this.buffer.copy(e,t,n,o),setImmediate(function(){i(null,c)})};M.prototype.write=function(e,t,r,n,i){e.copy(this.buffer,n,t,t+r),setImmediate(function(){i(null,r,e)})};M.prototype.createReadStream=function(e){e=e||{};var t=new si(e);t.destroyed=!1,t.start=e.start||0,t.endOffset=e.end,t.pos=t.endOffset||this.buffer.length;for(var r=this.buffer.slice(t.start,t.pos),n=0;;){var i=n+this.maxChunkSize;if(i>=r.length){n<r.length&&t.write(r.slice(n,r.length));break}t.write(r.slice(n,i)),n=i}return t.end(),t.destroy=function(){t.destroyed=!0},t};M.prototype.createWriteStream=function(e){var t=this;e=e||{};var r=new Ze(e);return r.start=e.start||0,r.endOffset=e.end==null?this.buffer.length:+e.end,r.bytesWritten=0,r.pos=r.start,r.destroyed=!1,r._write=function(n,i,o){if(!r.destroyed){var s=r.pos+n.length;if(s>r.endOffset){var c=new Error("maximum file length exceeded");c.code="ETOOBIG",r.destroyed=!0,o(c);return}n.copy(t.buffer,r.pos,0,n.length),r.bytesWritten+=n.length,r.pos=s,r.emit("progress"),o()}},r.destroy=function(){r.destroyed=!0},r};M.prototype.ref=function(){this.refCount+=1};M.prototype.unref=function(){if(this.refCount-=1,this.refCount<0)throw new Error("invalid unref")};function ci(e,t){return new M(e,t)}function ui(e,t){return new T(e,t)}});var mr=v((Fo,lr)=>{var U=require("buffer").Buffer,Qe=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(Qe=new Int32Array(Qe));function dr(e){if(U.isBuffer(e))return e;var t=typeof U.alloc=="function"&&typeof U.from=="function";if(typeof e=="number")return t?U.alloc(e):new U(e);if(typeof e=="string")return t?U.from(e):new U(e);throw new Error("input must be buffer, number, or string, received "+typeof e)}function fi(e){var t=dr(4);return t.writeInt32BE(e,0),t}function et(e,t){e=dr(e),U.isBuffer(t)&&(t=t.readUInt32BE(0));for(var r=~~t^-1,n=0;n<e.length;n++)r=Qe[(r^e[n])&255]^r>>>8;return r^-1}function tt(){return fi(et.apply(null,arguments))}tt.signed=function(){return et.apply(null,arguments)};tt.unsigned=function(){return et.apply(null,arguments)>>>0};lr.exports=tt});var wr=v(j=>{var rt=require("fs"),di=require("zlib"),pr=fr(),li=mr(),qe=require("util"),ze=require("events").EventEmitter,hr=require("stream").Transform,nt=require("stream").PassThrough,mi=require("stream").Writable;j.open=pi;j.fromFd=gr;j.fromBuffer=hi;j.fromRandomAccessReader=it;j.dosDateTimeToDate=yr;j.validateFileName=vr;j.ZipFile=D;j.Entry=de;j.RandomAccessReader=$;function pi(e,t,r){typeof t=="function"&&(r=t,t=null),t==null&&(t={}),t.autoClose==null&&(t.autoClose=!0),t.lazyEntries==null&&(t.lazyEntries=!1),t.decodeStrings==null&&(t.decodeStrings=!0),t.validateEntrySizes==null&&(t.validateEntrySizes=!0),t.strictFileNames==null&&(t.strictFileNames=!1),r==null&&(r=Ie),rt.open(e,"r",function(n,i){if(n)return r(n);gr(i,t,function(o,s){o&&rt.close(i,Ie),r(o,s)})})}function gr(e,t,r){typeof t=="function"&&(r=t,t=null),t==null&&(t={}),t.autoClose==null&&(t.autoClose=!1),t.lazyEntries==null&&(t.lazyEntries=!1),t.decodeStrings==null&&(t.decodeStrings=!0),t.validateEntrySizes==null&&(t.validateEntrySizes=!0),t.strictFileNames==null&&(t.strictFileNames=!1),r==null&&(r=Ie),rt.fstat(e,function(n,i){if(n)return r(n);var o=pr.createFromFd(e,{autoClose:!0});it(o,i.size,t,r)})}function hi(e,t,r){typeof t=="function"&&(r=t,t=null),t==null&&(t={}),t.autoClose=!1,t.lazyEntries==null&&(t.lazyEntries=!1),t.decodeStrings==null&&(t.decodeStrings=!0),t.validateEntrySizes==null&&(t.validateEntrySizes=!0),t.strictFileNames==null&&(t.strictFileNames=!1);var n=pr.createFromBuffer(e,{maxChunkSize:65536});it(n,e.length,t,r)}function it(e,t,r,n){typeof r=="function"&&(n=r,r=null),r==null&&(r={}),r.autoClose==null&&(r.autoClose=!0),r.lazyEntries==null&&(r.lazyEntries=!1),r.decodeStrings==null&&(r.decodeStrings=!0);var i=!!r.decodeStrings;if(r.validateEntrySizes==null&&(r.validateEntrySizes=!0),r.strictFileNames==null&&(r.strictFileNames=!1),n==null&&(n=Ie),typeof t!="number")throw new Error("expected totalSize parameter to be a number");if(t>Number.MAX_SAFE_INTEGER)throw new Error("zip file too large. only file sizes up to 2^52 are supported due to JavaScript's Number type being an IEEE 754 double.");e.ref();var o=22,s=65535,c=Math.min(o+s,t),u=A(c),f=t-u.length;ee(e,u,0,c,f,function(a){if(a)return n(a);for(var d=c-o;d>=0;d-=1)if(u.readUInt32LE(d)===101010256){var l=u.slice(d),h=l.readUInt16LE(4);if(h!==0)return n(new Error("multi-disk zip files are not supported: found disk number: "+h));var x=l.readUInt16LE(10),p=l.readUInt32LE(16),m=l.readUInt16LE(20),y=l.length-o;if(m!==y)return n(new Error("invalid comment length. expected: "+y+". found: "+m));var w=i?Oe(l,22,l.length,!1):l.slice(22);if(!(x===65535||p===4294967295))return n(null,new D(e,p,t,x,w,r.autoClose,r.lazyEntries,i,r.validateEntrySizes,r.strictFileNames));var F=A(20),N=f+d-F.length;ee(e,F,0,F.length,N,function(Y){if(Y)return n(Y);if(F.readUInt32LE(0)!==117853008)return n(new Error("invalid zip64 end of central directory locator signature"));var oe=te(F,8),k=A(56);ee(e,k,0,k.length,oe,function(se){return se?n(se):k.readUInt32LE(0)!==101075792?n(new Error("invalid zip64 end of central directory record signature")):(x=te(k,32),p=te(k,48),n(null,new D(e,p,t,x,w,r.autoClose,r.lazyEntries,i,r.validateEntrySizes,r.strictFileNames)))})});return}n(new Error("end of central directory record signature not found"))})}qe.inherits(D,ze);function D(e,t,r,n,i,o,s,c,u,f){var a=this;ze.call(a),a.reader=e,a.reader.on("error",function(d){xr(a,d)}),a.reader.once("close",function(){a.emit("close")}),a.readEntryCursor=t,a.fileSize=r,a.entryCount=n,a.comment=i,a.entriesRead=0,a.autoClose=!!o,a.lazyEntries=!!s,a.decodeStrings=!!c,a.validateEntrySizes=!!u,a.strictFileNames=!!f,a.isOpen=!0,a.emittedError=!1,a.lazyEntries||a._readEntry()}D.prototype.close=function(){!this.isOpen||(this.isOpen=!1,this.reader.unref())};function I(e,t){e.autoClose&&e.close(),xr(e,t)}function xr(e,t){e.emittedError||(e.emittedError=!0,e.emit("error",t))}D.prototype.readEntry=function(){if(!this.lazyEntries)throw new Error("readEntry() called without lazyEntries:true");this._readEntry()};D.prototype._readEntry=function(){var e=this;if(e.entryCount===e.entriesRead){setImmediate(function(){e.autoClose&&e.close(),!e.emittedError&&e.emit("end")});return}if(!e.emittedError){var t=A(46);ee(e.reader,t,0,t.length,e.readEntryCursor,function(r){if(r)return I(e,r);if(!e.emittedError){var n=new de,i=t.readUInt32LE(0);if(i!==33639248)return I(e,new Error("invalid central directory file header signature: 0x"+i.toString(16)));if(n.versionMadeBy=t.readUInt16LE(4),n.versionNeededToExtract=t.readUInt16LE(6),n.generalPurposeBitFlag=t.readUInt16LE(8),n.compressionMethod=t.readUInt16LE(10),n.lastModFileTime=t.readUInt16LE(12),n.lastModFileDate=t.readUInt16LE(14),n.crc32=t.readUInt32LE(16),n.compressedSize=t.readUInt32LE(20),n.uncompressedSize=t.readUInt32LE(24),n.fileNameLength=t.readUInt16LE(28),n.extraFieldLength=t.readUInt16LE(30),n.fileCommentLength=t.readUInt16LE(32),n.internalFileAttributes=t.readUInt16LE(36),n.externalFileAttributes=t.readUInt32LE(38),n.relativeOffsetOfLocalHeader=t.readUInt32LE(42),n.generalPurposeBitFlag&64)return I(e,new Error("strong encryption is not supported"));e.readEntryCursor+=46,t=A(n.fileNameLength+n.extraFieldLength+n.fileCommentLength),ee(e.reader,t,0,t.length,e.readEntryCursor,function(o){if(o)return I(e,o);if(!e.emittedError){var s=(n.generalPurposeBitFlag&2048)!==0;n.fileName=e.decodeStrings?Oe(t,0,n.fileNameLength,s):t.slice(0,n.fileNameLength);var c=n.fileNameLength+n.extraFieldLength,u=t.slice(n.fileNameLength,c);n.extraFields=[];for(var f=0;f<u.length-3;){var a=u.readUInt16LE(f+0),d=u.readUInt16LE(f+2),l=f+4,h=l+d;if(h>u.length)return I(e,new Error("extra field length exceeds extra field buffer size"));var x=A(d);u.copy(x,0,l,h),n.extraFields.push({id:a,data:x}),f=h}if(n.fileComment=e.decodeStrings?Oe(t,c,c+n.fileCommentLength,s):t.slice(c,c+n.fileCommentLength),n.comment=n.fileComment,e.readEntryCursor+=t.length,e.entriesRead+=1,n.uncompressedSize===4294967295||n.compressedSize===4294967295||n.relativeOffsetOfLocalHeader===4294967295){for(var p=null,f=0;f<n.extraFields.length;f++){var m=n.extraFields[f];if(m.id===1){p=m.data;break}}if(p==null)return I(e,new Error("expected zip64 extended information extra field"));var y=0;if(n.uncompressedSize===4294967295){if(y+8>p.length)return I(e,new Error("zip64 extended information extra field does not include uncompressed size"));n.uncompressedSize=te(p,y),y+=8}if(n.compressedSize===4294967295){if(y+8>p.length)return I(e,new Error("zip64 extended information extra field does not include compressed size"));n.compressedSize=te(p,y),y+=8}if(n.relativeOffsetOfLocalHeader===4294967295){if(y+8>p.length)return I(e,new Error("zip64 extended information extra field does not include relative header offset"));n.relativeOffsetOfLocalHeader=te(p,y),y+=8}}if(e.decodeStrings)for(var f=0;f<n.extraFields.length;f++){var m=n.extraFields[f];if(m.id===28789){if(m.data.length<6||m.data.readUInt8(0)!==1)continue;var w=m.data.readUInt32LE(1);if(li.unsigned(t.slice(0,n.fileNameLength))!==w)continue;n.fileName=Oe(m.data,5,m.data.length,!0);break}}if(e.validateEntrySizes&&n.compressionMethod===0){var F=n.uncompressedSize;if(n.isEncrypted()&&(F+=12),n.compressedSize!==F){var N="compressed/uncompressed size mismatch for stored file: "+n.compressedSize+" != "+n.uncompressedSize;return I(e,new Error(N))}}if(e.decodeStrings){e.strictFileNames||(n.fileName=n.fileName.replace(/\\/g,"/"));var Y=vr(n.fileName,e.validateFileNameOptions);if(Y!=null)return I(e,new Error(Y))}e.emit("entry",n),e.lazyEntries||e._readEntry()}})}})}};D.prototype.openReadStream=function(e,t,r){var n=this,i=0,o=e.compressedSize;if(r==null)r=t,t={};else{if(t.decrypt!=null){if(!e.isEncrypted())throw new Error("options.decrypt can only be specified for encrypted entries");if(t.decrypt!==!1)throw new Error("invalid options.decrypt value: "+t.decrypt);if(e.isCompressed()&&t.decompress!==!1)throw new Error("entry is encrypted and compressed, and options.decompress !== false")}if(t.decompress!=null){if(!e.isCompressed())throw new Error("options.decompress can only be specified for compressed entries");if(!(t.decompress===!1||t.decompress===!0))throw new Error("invalid options.decompress value: "+t.decompress)}if(t.start!=null||t.end!=null){if(e.isCompressed()&&t.decompress!==!1)throw new Error("start/end range not allowed for compressed entry without options.decompress === false");if(e.isEncrypted()&&t.decrypt!==!1)throw new Error("start/end range not allowed for encrypted entry without options.decrypt === false")}if(t.start!=null){if(i=t.start,i<0)throw new Error("options.start < 0");if(i>e.compressedSize)throw new Error("options.start > entry.compressedSize")}if(t.end!=null){if(o=t.end,o<0)throw new Error("options.end < 0");if(o>e.compressedSize)throw new Error("options.end > entry.compressedSize");if(o<i)throw new Error("options.end < options.start")}}if(!n.isOpen)return r(new Error("closed"));if(e.isEncrypted()&&t.decrypt!==!1)return r(new Error("entry is encrypted, and options.decrypt !== false"));n.reader.ref();var s=A(30);ee(n.reader,s,0,s.length,e.relativeOffsetOfLocalHeader,function(c){try{if(c)return r(c);var u=s.readUInt32LE(0);if(u!==67324752)return r(new Error("invalid local file header signature: 0x"+u.toString(16)));var f=s.readUInt16LE(26),a=s.readUInt16LE(28),d=e.relativeOffsetOfLocalHeader+s.length+f+a,l;if(e.compressionMethod===0)l=!1;else if(e.compressionMethod===8)l=t.decompress!=null?t.decompress:!0;else return r(new Error("unsupported compression method: "+e.compressionMethod));var h=d,x=h+e.compressedSize;if(e.compressedSize!==0&&x>n.fileSize)return r(new Error("file data overflows file bounds: "+h+" + "+e.compressedSize+" > "+n.fileSize));var p=n.reader.createReadStream({start:h+i,end:h+o}),m=p;if(l){var y=!1,w=di.createInflateRaw();p.on("error",function(F){setImmediate(function(){y||w.emit("error",F)})}),p.pipe(w),n.validateEntrySizes?(m=new le(e.uncompressedSize),w.on("error",function(F){setImmediate(function(){y||m.emit("error",F)})}),w.pipe(m)):m=w,m.destroy=function(){y=!0,w!==m&&w.unpipe(m),p.unpipe(w),p.destroy()}}r(null,m)}finally{n.reader.unref()}})};function de(){}de.prototype.getLastModDate=function(){return yr(this.lastModFileDate,this.lastModFileTime)};de.prototype.isEncrypted=function(){return(this.generalPurposeBitFlag&1)!==0};de.prototype.isCompressed=function(){return this.compressionMethod===8};function yr(e,t){var r=e&31,n=(e>>5&15)-1,i=(e>>9&127)+1980,o=0,s=(t&31)*2,c=t>>5&63,u=t>>11&31;return new Date(i,n,r,u,c,s,o)}function vr(e){return e.indexOf("\\")!==-1?"invalid characters in fileName: "+e:/^[a-zA-Z]:/.test(e)||/^\//.test(e)?"absolute path: "+e:e.split("/").indexOf("..")!==-1?"invalid relative path: "+e:null}function ee(e,t,r,n,i,o){if(n===0)return setImmediate(function(){o(null,A(0))});e.read(t,r,n,i,function(s,c){if(s)return o(s);if(c<n)return o(new Error("unexpected EOF"));o()})}qe.inherits(le,hr);function le(e){hr.call(this),this.actualByteCount=0,this.expectedByteCount=e}le.prototype._transform=function(e,t,r){if(this.actualByteCount+=e.length,this.actualByteCount>this.expectedByteCount){var n="too many bytes in the stream. expected "+this.expectedByteCount+". got at least "+this.actualByteCount;return r(new Error(n))}r(null,e)};le.prototype._flush=function(e){if(this.actualByteCount<this.expectedByteCount){var t="not enough bytes in the stream. expected "+this.expectedByteCount+". got only "+this.actualByteCount;return e(new Error(t))}e()};qe.inherits($,ze);function $(){ze.call(this),this.refCount=0}$.prototype.ref=function(){this.refCount+=1};$.prototype.unref=function(){var e=this;if(e.refCount-=1,e.refCount>0)return;if(e.refCount<0)throw new Error("invalid unref");e.close(t);function t(r){if(r)return e.emit("error",r);e.emit("close")}};$.prototype.createReadStream=function(e){var t=e.start,r=e.end;if(t===r){var n=new nt;return setImmediate(function(){n.end()}),n}var i=this._readStreamForRange(t,r),o=!1,s=new Ae(this);i.on("error",function(u){setImmediate(function(){o||s.emit("error",u)})}),s.destroy=function(){i.unpipe(s),s.unref(),i.destroy()};var c=new le(r-t);return s.on("error",function(u){setImmediate(function(){o||c.emit("error",u)})}),c.destroy=function(){o=!0,s.unpipe(c),s.destroy()},i.pipe(s).pipe(c)};$.prototype._readStreamForRange=function(e,t){throw new Error("not implemented")};$.prototype.read=function(e,t,r,n,i){var o=this.createReadStream({start:n,end:n+r}),s=new mi,c=0;s._write=function(u,f,a){u.copy(e,t+c,0,u.length),c+=u.length,a()},s.on("finish",i),o.on("error",function(u){i(u)}),o.pipe(s)};$.prototype.close=function(e){setImmediate(e)};qe.inherits(Ae,nt);function Ae(e){nt.call(this),this.context=e,this.context.ref(),this.unreffedYet=!1}Ae.prototype._flush=function(e){this.unref(),e()};Ae.prototype.unref=function(e){this.unreffedYet||(this.unreffedYet=!0,this.context.unref())};var gi="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0";function Oe(e,t,r,n){if(n)return e.toString("utf8",t,r);for(var i="",o=t;o<r;o++)i+=gi[e[o]];return i}function te(e,t){var r=e.readUInt32LE(t),n=e.readUInt32LE(t+4);return n*4294967296+r}var A;typeof Buffer.allocUnsafe=="function"?A=function(e){return Buffer.allocUnsafe(e)}:A=function(e){return new Buffer(e)};function Ie(e){if(e)throw e}});var Cr=v((_o,br)=>{var q=Ge()("extract-zip"),{createWriteStream:xi,promises:re}=require("fs"),yi=ir(),V=require("path"),{promisify:st}=require("util"),vi=require("stream"),wi=wr(),bi=st(wi.open),Ci=st(vi.pipeline),ot=class{constructor(t,r){this.zipPath=t,this.opts=r}async extract(){return q("opening",this.zipPath,"with opts",this.opts),this.zipfile=await bi(this.zipPath,{lazyEntries:!0}),this.canceled=!1,new Promise((t,r)=>{this.zipfile.on("error",n=>{this.canceled=!0,r(n)}),this.zipfile.readEntry(),this.zipfile.on("close",()=>{this.canceled||(q("zip extraction complete"),t())}),this.zipfile.on("entry",async n=>{if(this.canceled){q("skipping entry",n.fileName,{cancelled:this.canceled});return}if(q("zipfile entry",n.fileName),n.fileName.startsWith("__MACOSX/")){this.zipfile.readEntry();return}let i=V.dirname(V.join(this.opts.dir,n.fileName));try{await re.mkdir(i,{recursive:!0});let o=await re.realpath(i);if(V.relative(this.opts.dir,o).split(V.sep).includes(".."))throw new Error(`Out of bound path "${o}" found while processing file ${n.fileName}`);await this.extractEntry(n),q("finished processing",n.fileName),this.zipfile.readEntry()}catch(o){this.canceled=!0,this.zipfile.close(),r(o)}})})}async extractEntry(t){if(this.canceled){q("skipping entry extraction",t.fileName,{cancelled:this.canceled});return}this.opts.onEntry&&this.opts.onEntry(t,this.zipfile);let r=V.join(this.opts.dir,t.fileName),n=t.externalFileAttributes>>16&65535,i=61440,o=16384,s=40960,c=(n&i)===s,u=(n&i)===o;!u&&t.fileName.endsWith("/")&&(u=!0);let f=t.versionMadeBy>>8;u||(u=f===0&&t.externalFileAttributes===16),q("extracting entry",{filename:t.fileName,isDir:u,isSymlink:c});let a=this.getExtractedMode(n,u)&511,d=u?r:V.dirname(r),l={recursive:!0};if(u&&(l.mode=a),q("mkdir",z({dir:d},l)),await re.mkdir(d,l),u)return;q("opening read stream",r);let h=await st(this.zipfile.openReadStream.bind(this.zipfile))(t);if(c){let x=await yi(h);q("creating symlink",x,r),await re.symlink(x,r)}else await Ci(h,xi(r,{mode:a}))}getExtractedMode(t,r){let n=t;return n===0&&(r?(this.opts.defaultDirMode&&(n=parseInt(this.opts.defaultDirMode,10)),n||(n=493)):(this.opts.defaultFileMode&&(n=parseInt(this.opts.defaultFileMode,10)),n||(n=420))),n}};br.exports=async function(e,t){if(q("creating target directory",t.dir),!V.isAbsolute(t.dir))throw new Error("Target directory is expected to be absolute");return await re.mkdir(t.dir,{recursive:!0}),t.dir=await re.realpath(t.dir),new ot(e,t).extract()}});var Fr=v((Ro,Er)=>{var me;Er.exports=function(){if(!me){try{me=Ge()("follow-redirects")}catch{}typeof me!="function"&&(me=function(){})}me.apply(null,arguments)}});var qr=v((Lo,dt)=>{var G=require("url"),at=G.URL,Ei=require("http"),Fi=require("https"),Rr=require("stream").Writable,Si=require("assert"),Lr=Fr(),ut=["abort","aborted","connect","error","socket","timeout"],ft=Object.create(null);ut.forEach(function(e){ft[e]=function(t,r,n){this._redirectable.emit(e,t,r,n)}});var Sr=je("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),_i=je("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded"),Ri=je("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),Li=je("ERR_STREAM_WRITE_AFTER_END","write after end");function L(e,t){Rr.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var r=this;this._onNativeResponse=function(n){r._processResponse(n)},this._performRequest()}L.prototype=Object.create(Rr.prototype);L.prototype.abort=function(){Ir(this._currentRequest),this.emit("abort")};L.prototype.write=function(e,t,r){if(this._ending)throw new Li;if(!(typeof e=="string"||typeof e=="object"&&"length"in e))throw new TypeError("data should be a string, Buffer or Uint8Array");if(typeof t=="function"&&(r=t,t=null),e.length===0){r&&r();return}this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,r)):(this.emit("error",new Ri),this.abort())};L.prototype.end=function(e,t,r){if(typeof e=="function"?(r=e,e=t=null):typeof t=="function"&&(r=t,t=null),!e)this._ended=this._ending=!0,this._currentRequest.end(null,null,r);else{var n=this,i=this._currentRequest;this.write(e,t,function(){n._ended=!0,i.end(null,null,r)}),this._ending=!0}};L.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)};L.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)};L.prototype.setTimeout=function(e,t){var r=this;function n(s){s.setTimeout(e),s.removeListener("timeout",s.destroy),s.addListener("timeout",s.destroy)}function i(s){r._timeout&&clearTimeout(r._timeout),r._timeout=setTimeout(function(){r.emit("timeout"),o()},e),n(s)}function o(){r._timeout&&(clearTimeout(r._timeout),r._timeout=null),r.removeListener("abort",o),r.removeListener("error",o),r.removeListener("response",o),t&&r.removeListener("timeout",t),r.socket||r._currentRequest.removeListener("socket",i)}return t&&this.on("timeout",t),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",n),this.on("abort",o),this.on("error",o),this.on("response",o),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(e){L.prototype[e]=function(t,r){return this._currentRequest[e](t,r)}});["aborted","connection","socket"].forEach(function(e){Object.defineProperty(L.prototype,e,{get:function(){return this._currentRequest[e]}})});L.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}};L.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(!t){this.emit("error",new TypeError("Unsupported protocol "+e));return}if(this._options.agents){var r=e.slice(0,-1);this._options.agent=this._options.agents[r]}var n=this._currentRequest=t.request(this._options,this._onNativeResponse);n._redirectable=this;for(var i of ut)n.on(i,ft[i]);if(this._currentUrl=/^\//.test(this._options.path)?G.format(this._options):this._currentUrl=this._options.path,this._isRedirect){var o=0,s=this,c=this._requestBodyBuffers;(function u(f){if(n===s._currentRequest)if(f)s.emit("error",f);else if(o<c.length){var a=c[o++];n.finished||n.write(a.data,a.encoding,u)}else s._ended&&n.end()})()}};L.prototype._processResponse=function(e){var t=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:t});var r=e.headers.location;if(!r||this._options.followRedirects===!1||t<300||t>=400){e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),this._requestBodyBuffers=[];return}if(Ir(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects){this.emit("error",new _i);return}var n,i=this._options.beforeRedirect;i&&(n=Object.assign({Host:e.req.getHeader("host")},this._options.headers));var o=this._options.method;((t===301||t===302)&&this._options.method==="POST"||t===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],ct(/^content-/i,this._options.headers));var s=ct(/^host$/i,this._options.headers),c=G.parse(this._currentUrl),u=s||c.host,f=/^\w+:/.test(r)?this._currentUrl:G.format(Object.assign(c,{host:u})),a;try{a=G.resolve(f,r)}catch(x){this.emit("error",new Sr(x));return}Lr("redirecting to",a),this._isRedirect=!0;var d=G.parse(a);if(Object.assign(this._options,d),(d.protocol!==c.protocol&&d.protocol!=="https:"||d.host!==u&&!Ii(d.host,u))&&ct(/^(?:authorization|cookie)$/i,this._options.headers),typeof i=="function"){var l={headers:e.headers,statusCode:t},h={url:f,method:o,headers:n};try{i(this._options,l,h)}catch(x){this.emit("error",x);return}this._sanitizeOptions(this._options)}try{this._performRequest()}catch(x){this.emit("error",new Sr(x))}};function Or(e){var t={maxRedirects:21,maxBodyLength:10485760},r={};return Object.keys(e).forEach(function(n){var i=n+":",o=r[i]=e[n],s=t[n]=Object.create(o);function c(f,a,d){if(typeof f=="string"){var l=f;try{f=_r(new at(l))}catch{f=G.parse(l)}}else at&&f instanceof at?f=_r(f):(d=a,a=f,f={protocol:i});return typeof a=="function"&&(d=a,a=null),a=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},f,a),a.nativeProtocols=r,Si.equal(a.protocol,i,"protocol mismatch"),Lr("options",a),new L(a,d)}function u(f,a,d){var l=s.request(f,a,d);return l.end(),l}Object.defineProperties(s,{request:{value:c,configurable:!0,enumerable:!0,writable:!0},get:{value:u,configurable:!0,enumerable:!0,writable:!0}})}),t}function Oi(){}function _r(e){var t={protocol:e.protocol,hostname:e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname,hash:e.hash,search:e.search,pathname:e.pathname,path:e.pathname+e.search,href:e.href};return e.port!==""&&(t.port=Number(e.port)),t}function ct(e,t){var r;for(var n in t)e.test(n)&&(r=t[n],delete t[n]);return r===null||typeof r>"u"?void 0:String(r).trim()}function je(e,t){function r(n){Error.captureStackTrace(this,this.constructor),n?(this.message=t+": "+n.message,this.cause=n):this.message=t}return r.prototype=new Error,r.prototype.constructor=r,r.prototype.name="Error ["+e+"]",r.prototype.code=e,r}function Ir(e){for(var t of ut)e.removeListener(t,ft[t]);e.on("error",Oi),e.abort()}function Ii(e,t){let r=e.length-t.length-1;return r>0&&e[r]==="."&&e.endsWith(t)}dt.exports=Or({http:Ei,https:Fi});dt.exports.wrap=Or});var Tr=v((Oo,Pr)=>{Pr.exports=jr;jr.sync=zi;var zr=require("fs");function qi(e,t){var r=t.pathExt!==void 0?t.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var n=0;n<r.length;n++){var i=r[n].toLowerCase();if(i&&e.substr(-i.length).toLowerCase()===i)return!0}return!1}function Ar(e,t,r){return!e.isSymbolicLink()&&!e.isFile()?!1:qi(t,r)}function jr(e,t,r){zr.stat(e,function(n,i){r(n,n?!1:Ar(i,e,t))})}function zi(e,t){return Ar(zr.statSync(e),e,t)}});var Dr=v((Io,Ur)=>{Ur.exports=Nr;Nr.sync=Ai;var Mr=require("fs");function Nr(e,t,r){Mr.stat(e,function(n,i){r(n,n?!1:Br(i,t))})}function Ai(e,t){return Br(Mr.statSync(e),t)}function Br(e,t){return e.isFile()&&ji(e,t)}function ji(e,t){var r=e.mode,n=e.uid,i=e.gid,o=t.uid!==void 0?t.uid:process.getuid&&process.getuid(),s=t.gid!==void 0?t.gid:process.getgid&&process.getgid(),c=parseInt("100",8),u=parseInt("010",8),f=parseInt("001",8),a=c|u,d=r&f||r&u&&i===s||r&c&&n===o||r&a&&o===0;return d}});var Hr=v((zo,$r)=>{var qo=require("fs"),Pe;process.platform==="win32"||global.TESTING_WINDOWS?Pe=Tr():Pe=Dr();$r.exports=lt;lt.sync=Pi;function lt(e,t,r){if(typeof t=="function"&&(r=t,t={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(n,i){lt(e,t||{},function(o,s){o?i(o):n(s)})})}Pe(e,t||{},function(n,i){n&&(n.code==="EACCES"||t&&t.ignoreErrors)&&(n=null,i=!1),r(n,i)})}function Pi(e,t){try{return Pe.sync(e,t||{})}catch(r){if(t&&t.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var Xr=v((Ao,Yr)=>{var ne=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",kr=require("path"),Ti=ne?";":":",Wr=Hr(),Vr=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),Gr=(e,t)=>{let r=t.colon||Ti,n=e.match(/\//)||ne&&e.match(/\\/)?[""]:[...ne?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(r)],i=ne?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",o=ne?i.split(r):[""];return ne&&e.indexOf(".")!==-1&&o[0]!==""&&o.unshift(""),{pathEnv:n,pathExt:o,pathExtExe:i}},Jr=(e,t,r)=>{typeof t=="function"&&(r=t,t={}),t||(t={});let{pathEnv:n,pathExt:i,pathExtExe:o}=Gr(e,t),s=[],c=f=>new Promise((a,d)=>{if(f===n.length)return t.all&&s.length?a(s):d(Vr(e));let l=n[f],h=/^".*"$/.test(l)?l.slice(1,-1):l,x=kr.join(h,e),p=!h&&/^\.[\\\/]/.test(e)?e.slice(0,2)+x:x;a(u(p,f,0))}),u=(f,a,d)=>new Promise((l,h)=>{if(d===i.length)return l(c(a+1));let x=i[d];Wr(f+x,{pathExt:o},(p,m)=>{if(!p&&m)if(t.all)s.push(f+x);else return l(f+x);return l(u(f,a,d+1))})});return r?c(0).then(f=>r(null,f),r):c(0)},Mi=(e,t)=>{t=t||{};let{pathEnv:r,pathExt:n,pathExtExe:i}=Gr(e,t),o=[];for(let s=0;s<r.length;s++){let c=r[s],u=/^".*"$/.test(c)?c.slice(1,-1):c,f=kr.join(u,e),a=!u&&/^\.[\\\/]/.test(e)?e.slice(0,2)+f:f;for(let d=0;d<n.length;d++){let l=a+n[d];try{if(Wr.sync(l,{pathExt:i}))if(t.all)o.push(l);else return l}catch{}}}if(t.all&&o.length)return o;if(t.nothrow)return null;throw Vr(e)};Yr.exports=Jr;Jr.sync=Mi});var Yi={};bt(Yi,{activate:()=>Ji});module.exports=mn(Yi);var J=require("coc.nvim");var Rt=require("coc.nvim"),Be=P(require("path"));var Et=require("coc.nvim"),Ft=require("os"),he=[{scheme:"file",language:"clojure"},{scheme:"jar",language:"clojure"},{scheme:"zipfile",language:"clojure"}];function St(e){for(let t in e)!e[t]||typeof e[t]!="object"||(St(e[t]),Object.keys(e[t]).length===0&&delete e[t]);return e}function _(){let e=Et.workspace.getConfiguration("clojure"),t=e.get("lsp-install-path"),r=z({},e.get("initialization-options",{}));St(r);for(let[n,i]of Object.entries(r))Array.isArray(i)&&i.length===0&&delete r[n];return{checkOnStart:e.get("lsp-check-on-start"),keymaps:e.get("keymaps"),enable:e.get("enable"),executable:e.get("executable"),executableArgs:e.get("executable-args",null)||e.get("executableArgs",null)||[],initializationOptions:r,lspVersion:e.get("lsp-version"),lspInstallPath:t!=null&&t.startsWith("~")?t.replace("~",(0,Ft.homedir)()):t,startupMessage:e.get("startup-message")}}var g;function _t(e){g=e.logger}function Lt(e){g.info("Creating client");let t=Be.default.extname(e)===".jar",r=process.env.JAVA_HOME;if(t&&!r){g.error("Trying to use a jar without JAVA_HOME.");return}let n=t?{command:Be.default.join(process.env.JAVA_HOME,"bin","java"),args:["-jar",e]}:{command:e,args:_().executableArgs};g.debug("ServerOptions",n);let i={run:n,debug:n},o={disabledFeatures:["signatureHelp"],documentSelector:he,initializationOptions:_().initializationOptions};return new Rt.LanguageClient("clojure","Clojure Language Client",i,o)}var C=require("coc.nvim");var Ue={};bt(Ue,{commands:()=>It,default:()=>pn});var It=[{command:"add-import-to-namespace",description:"Add specific require form to current namespace declaration",prompt:"Library name?",shortcut:"ai"},{command:"add-missing-import",description:"Add Java import for symbol under cursor to current namespace declaration"},{command:"add-missing-libspec",description:"Add require form for symbol under cursor to current namespace declaration",shortcut:"am"},{command:"add-require-suggestion",description:"Add suggested require to ns form",shortcut:"as"},{aliases:["change-coll"],choices:["list","map","set","vector"],command:"change-collection",description:"Choose new type of collection",prompt:"New coll type"},{command:"clean-ns",description:"Sort and remove unused required libraries in namespace declaration",shortcut:"cn"},{command:"create-function",description:"Create a function from the current form",shortcut:"fe"},{command:"create-test",description:"Creates a test somewhere, who knows",shortcut:"ct"},{command:"cursor-info",description:"Show debugging information for the symbol at cursor"},{command:"cycle-coll",description:"Cycle the kind of collection: list -> map -> vector -> set -> list",shortcut:"cc"},{command:"cycle-privacy",description:"Cycle the privacy of current function definition",shortcut:"cp"},{command:"demote-fn",description:"Demote fn to #()",shortcut:"dm"},{command:"destructure-keys",description:"Destructure keys",shortcut:"dk"},{command:"docs",description:"Read the docs for a given symbol (in given namespace)"},{aliases:["move-coll-entry-up"],command:"drag-backward",description:"Move coll entry backward in collection",shortcut:"db"},{command:"drag-param-backward",description:"Move param backwards in function definition (and all call sites)",shortcut:"ab"},{aliases:["move-coll-entry-down"],command:"drag-forward",description:"Move coll entry forward in collection",shortcut:"df"},{command:"drag-param-forward",description:"Move param forward in function definition (and all call sites)",shortcut:"af"},{command:"expand-let",description:"Move current let form up a level",shortcut:"el"},{command:"extract-function",description:"Move current form into new top-level function",prompt:"Function name?",shortcut:"ef"},{command:"extract-to-def",description:"Move current form into new top-level def",prompt:"Symbol name?",shortcut:"ed"},{command:"get-in-all",description:"Replace current and all nested forms with get-in form",shortcut:"ga"},{command:"get-in-less",description:"Replace first form in current get-in form with nested form",shortcut:"gl"},{command:"get-in-more",description:"Move current form to current get-in form",shortcut:"gm"},{command:"get-in-none",description:"Replace entire current get-in form with nested form",shortcut:"gn"},{command:"inline-symbol",description:"Replace all instances of symbol with symbol definition",shortcut:"is"},{command:"introduce-let",description:"Move current form to let-bound variable",prompt:"Bind to?",shortcut:"il"},{command:"move-form",description:"Move form under cursor to specified file",prompt:"Which file?",shortcut:"mf"},{command:"move-to-let",description:"Move current form into surrounding let block",prompt:"Bind to?",shortcut:"ml"},{command:"promote-fn",description:"Promote #() to fn, or fn to defn",shortcut:"pf"},{command:"resolve-macro-as",description:"Add entry to .clj-kondo/config.edn to resolve macro as another macro",shortcut:"ma"},{command:"restructure-keys",description:"Inline destructured keys with nested calls",shortcut:"rk"},{command:"server-info",description:"Show server configuration information"},{aliases:["sort-map"],command:"sort-clauses",description:"Sort entries within current clauses/list/map/set/vector",shortcut:"sl"},{command:"suppress-diagnostic",description:"Add a :clj-kondo/ignore to suppress linting current line",prompt:"Lint to ignore?"},{command:"thread-first",description:"Replace current form with thread-first expession",shortcut:"th"},{command:"thread-first-all",description:"Replace current and all nested forms with thread-first form",shortcut:"tf"},{command:"thread-last",description:"Replace current form with thread-last expession",shortcut:"tt"},{command:"thread-last-all",description:"Replace current and all nested forms with thread-last form",shortcut:"tl"},{command:"unwind-all",description:"Replace entire current threaded form with nested form",shortcut:"ua"},{command:"unwind-thread",description:"Replace first two forms in current threaded form with nested form",shortcut:"uw"}],pn={commands:It};async function De(e,t=""){return e?(await C.window.requestInput(e,t)).trim():void 0}async function hn(e){let t=await De("Var name?"),r=await De("Namespace?","clojure.core");if(t&&r){let n=await e.sendRequest("clojure/clojuredocs/raw",{symName:t,symNs:r}).catch(i=>{C.window.showErrorMessage(i)});n&&await C.window.showDialog({title:`${n.ns}/${n.name}`,content:n.doc})}}async function zt(){let{line:e,character:t}=await C.window.getCursorPosition();return[(await C.workspace.document).uri,e,t]}var gn=[{command:"docs",fn:hn},{command:"cursor-info",fn:async e=>{let[t,r,n]=await zt();e.sendNotification("clojure/cursorInfo/log",{textDocument:{uri:t},position:{line:r,character:n}})}},{command:"server-info",fn:async e=>{e.sendNotification("clojure/serverInfo/log")}}],qt=(()=>{let{commands:e}=Ue,t=new Map;return e.concat(gn).forEach(r=>{let n=r.command;t.has(n)||t.set(n,{command:n});for(let[i,o]of Object.entries(r)){let s=t.get(n);s&&!s[i]&&(s[i]=o)}}),Array.from(t.values())})();async function $e(e,{command:t},r=[]){let n=await zt();return e.sendRequest("workspace/executeCommand",{command:t,arguments:n.concat(r)}).catch(i=>{C.window.showErrorMessage(i)})}async function xn(e,t){if(!e||!t)return;let r=await C.window.showMenuPicker(t,{title:e});if(r!==-1)return t[r]}async function yn(e,t){let{title:r,choices:n}=t,i=await xn(r,n),o=[];return i&&o.push(i),$e(e,t,o)}async function vn(e,t){let{title:r}=t,n=await De(r);if(n)return $e(e,t,[n])}function wn(e,t,r){let{command:n,fn:i,title:o,choices:s,aliases:c}=r,u=`lsp-clojure-${n}`,f=async()=>{if(s&&!C.workspace.env.dialog){g.info(`Workspace doesn't allow dialogs, cancelling command ${u}`);return}else{if(i)return g.debug(`Executing 'fn' command ${u}`),i(t);s?(g.debug(`Executing 'choices' command ${u}`),await yn(t,r)):o?(g.debug(`Executing 'prompt' command ${u}`),await vn(t,r)):(g.debug(`Executing 'position' command ${u}`),await $e(t,r))}};g.debug(`Registering command ${u}`),e.subscriptions.push(C.commands.registerCommand(u,f)),c&&c.forEach(a=>{let d=`lsp-clojure-${a}`;g.debug(`Registering command ${d} as alias of ${u}`),e.subscriptions.push(C.commands.registerCommand(d,f))})}function bn(e,t,r){let{command:n,shortcut:i}=t,o=`lsp-clojure-${n}`,s=`${r.shortcut}${i}`;try{g.debug(`Creating keymap '${s}' for command '${o}'`),C.workspace.nvim.command(`nnoremap <silent> ${s} :call CocActionAsync('runCommand', '${o}')<CR>`,!0),e.subscriptions.push(C.Disposable.create(()=>{C.workspace.nvim.command(`nunmap ${s}`,!0)}))}catch(c){g.error(`Can't create keymapping ${s} for command ${n}`,c)}}function At(e,t){for(let n of qt)wn(e,t,n);let{keymaps:r}=_();if(r.enable)for(let n of qt.filter(i=>i.shortcut))bn(e,n,r)}var gt=require("coc.nvim"),en=P(Cr()),xt=P(qr()),S=P(require("fs")),ht=require("os"),H=P(require("path")),tn=require("url"),rn=P(Xr());var Kr=P(require("fs")),pe=P(require("path")),ie=P(require("process"));var Ni="clojure-lsp-version",Bi={darwin:{x64:"clojure-lsp-native-macos-amd64.zip",arm64:"clojure-lsp-native-macos-amd64.zip"},linux:{x64:"clojure-lsp-native-static-linux-amd64.zip",arm64:"clojure-lsp-native-linux-aarch64.zip"},win32:{x64:"clojure-lsp-native-windows-amd64.zip"}};function mt(e=ie.platform,t=ie.arch){var r;return((r=Bi[e])==null?void 0:r[t])??"clojure-lsp-standalone.jar"}function Te(e,t=ie.platform,r=ie.arch){let n=mt(t,r);return pe.extname(n).toLowerCase()!==".jar"&&(n=r==="win32"?"clojure-lsp.exe":"clojure-lsp"),pe.join(e,n)}function pt(e){return pe.join(e,Ni)}function Zr(e){let t=pt(e);try{return Kr.readFileSync(t,"utf8")}catch(r){return g.error("Could not read clojure-lsp version file.",r.message),""}}async function Ui(e){let t=new tn.URL(e);return new Promise((r,n)=>{xt.https.get({host:t.hostname,path:t.pathname,port:t.port,headers:{"user-agent":"node.js"}},i=>{let o="";i.on("data",s=>{o+=s}),i.on("end",()=>{r(o)})}).on("error",i=>{g.error(`Error downloading file from ${t}: ${i.message}`),n(i)})})}async function Di(){try{let e=await Ui("https://api.github.com/repos/clojure-lsp/clojure-lsp/releases");return JSON.parse(e)[0].tag_name}catch(e){return g.error("Error while finding latest clojure-lsp version.",e.message),""}}function $i(e){let t=H.default.join(H.default.dirname(e),"backup"),r=H.default.join(t,H.default.basename(e));try{S.default.existsSync(t)||S.default.mkdirSync(t),g.info("Backing up existing clojure-lsp to",r),S.default.renameSync(e,r)}catch(n){g.error("Error while backing up existing clojure-lsp file.",n.message)}return r}function Hi(e,t){g.info("Downloading clojure-lsp from",e);let r=gt.window.createStatusBarItem(0,{progress:!0});return r.show(),new Promise((n,i)=>{xt.https.get(e,o=>{if(o.statusCode===200){let s=S.default.createWriteStream(t),c=0,u=Number(o.headers["content-length"]);o.on("data",f=>{c+=f.length;let a=(c/u*100).toFixed(2);r.text=`${a}% Downloading clojure-lsp`}).on("end",()=>{s.close(),r.hide(),g.info("Clojure-lsp artifact downloaded to",t),n()}).pipe(s)}else o.resume(),r.hide(),i(new Error(o.statusMessage))}).on("error",(...o)=>(r.hide(),i(...o)))})}function ki(e,t){g.info("Writing version file");let r=pt(e);try{S.default.writeFileSync(r,t)}catch(n){g.error("Could not write clojure-lsp version file.",n.message)}}async function Wi(e,t){return g.info("Unzipping file"),(0,en.default)(e,{dir:t})}async function Vi(e,t){let r=mt(),n=t!=="nightly"?`https://github.com/clojure-lsp/clojure-lsp/releases/download/${t}/${r}`:`https://nightly.link/clojure-lsp/clojure-lsp/workflows/nightly/master/${r}`,i=H.default.join(e,r),o=Te(e),s=S.default.existsSync(o)?$i(o):o;try{await Hi(n,i),H.default.extname(i)===".zip"&&await Wi(i,e),H.default.extname(o)===""&&S.default.chmodSync(o,509),ki(e,t)}catch(c){return g.error("Error downloading clojure-lsp.",c.message),s}return o}function Gi(e){let{executable:t,lspInstallPath:r}=_();{let n=rn.default.sync(t,{nothrow:!0});if(n)return n}if(t.startsWith("~/")&&(t=t.replace("~",(0,ht.homedir)())),(0,S.existsSync)(t)||(r!=null&&r.startsWith("~/")?r=r.replace("~",(0,ht.homedir)()):r=e,t=Te(r),(0,S.existsSync)(t)))return t}async function Qr(e,t){if(await gt.window.showQuickpick(["Yes","No"],`clojure-lsp is ${t}. Download from Github?`)==0){let{lspVersion:n,lspInstallPath:i}=_(),o=Zr(e),s=["","latest"].includes(n)?await Di():n;if(o!==s&&s!==""){let u=await Vi(i||e,s);return g.info(`Successfully downloaded clojure-lsp to ${u}`),u}}}async function nn(e){let t=e.storagePath;(0,S.existsSync)(t)||(0,S.mkdirSync)(t);let r=Gi(t);if(g.debug("existing clojure-lsp bin:",r),r){let n=Te(t);_().checkOnStart&&r===n&&(r=await Qr(t,"outdated"))}else r=await Qr(t,"not found");return r}var Me=class{constructor(t){this.client=t}async provideSignatureHelp(t,r,n,i){return this.client.sendRequest("textDocument/signatureHelp",{textDocument:{uri:t.uri},position:r,context:i},n).catch(o=>this.client.handleFailedRequest({method:"textDocument/signatureHelp"},n,o,null))}};async function Ji(e){if(_t(e),g.info("Starting up coc-clojure"),!_().enable)return;let t=null;_().startupMessage&&(t=J.window.createStatusBarItem(void 0,{progress:!0}),t.text="Loading clojure-lsp",t.show());let r=await nn(e);if(!r){g.error("No clojure-lsp installed"),t==null||t.dispose();return}let n=Lt(r);if(!n){t==null||t.dispose();return}e.subscriptions.push(J.services.registLanguageClient(n)),e.subscriptions.push(J.languages.registerSignatureHelpProvider(he,new Me(n),["("," "])),At(e,n),await n.onReady(),_().startupMessage&&(t==null||t.dispose(),J.window.showInformationMessage("clojure-lsp loaded!"))}0&&(module.exports={activate});
